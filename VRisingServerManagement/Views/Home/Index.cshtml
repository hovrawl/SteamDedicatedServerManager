@{
    ViewData["Title"] = "V Rising Server Manager";
}

<div class="text-center">
    <h1 class="display-4">V Rising Server Manager</h1>
    <p>Cards that will link to Each page; Settings, Console</p>
    <button class="h-download-btn" type="button">Download V Rising Server</button>
    
    <textarea class="h-download-console">
        
    </textarea>
</div>


<script type="text/javascript">   
    VRisingServerManager = {
        
        
    }

    function downloadVRisingServer(){
        let downloadConsole = $('.h-download-console');
        let source = new EventSource('/console-sse');
        source.onopen = function (){
            console.log('Download Console Connected');
        }
        source.onerror = function (event){
            source.close();
        }
        source.onmessage = function (event){
            if (event.data){
                downloadConsole.append(event.data);
            }
        }
        VRisingServerManager.DownloadConsoleEventSource = source;
                
        fetch('@Url.Action("DownloadVRisingServer")', {
            method: 'POST'
        }).then((response) => {
            // Disconnect the source on finish
            if (VRisingServerManager.DownloadConsoleEventSource && VRisingServerManager.DownloadConsoleEventSource.close){
                VRisingServerManager.DownloadConsoleEventSource.close();
            }    
        })
    }
    $(document).ready(function (){
        // on start function
        let downloadBtn = $('.h-download-btn');
        downloadBtn.on('click', downloadVRisingServer);
    
        
        
    });
    
</script>